Macintosh Install

Last edited: Sat Oct 20, 2012

Sections:

    COMPILE:
    INSTALL or UPGRADE:
    CONFIGURE:
    FIRST STARTUP:
    (AUTO)START/STOP:
    AUTOSTART:
    CHECKING DAEMON STATUS:
    TRIMMING LOG FILES:

If NCID does not work, see INSTALL for some simple tests.
If using sip2ncid, see Setup-sip2ncid.

COMPILE:

    - See INSTALL

INSTALL or UPGRADE:

    NCID requires the server and at least one client to function. The
    server is required on one computer or device, but the client can be
    installed on as many computers as needed.

    Install ncid:
        - The NCID package normally installs in /usr/local.

        - If a binary package is available:
            Copy ncid-VERSION.mac-osx.tgz to the Mac, then:
                sudo tar -xzvf ncid-VERSION-mac-osx.tgz -C /
                EXAMPLE: sudo tar -xzvf ncid-0.64.mac-osx.tgz -C /

        - If there is no binary package, you need to compile the source:
            Copy ncid-VERSION-src.tar.gz to the Mac, then:
                tar -xzvf ncid-VERSION-src.tar.gz
                cd ncid
                make mac (compiles for /usr/local, see top of Makefile)
                sudo make mac-install
                        
    Upgrade ncid:
        - The NCID package normally installs in /usr/local and configuration
          files are normally in /usr/local/etc/ncid.
          
        - If a binary package is available:
            Extracting the tar file will REPLACE the contents of all of
            the NCID configuration files. Be sure to back them up first.
            This includes:
                 - all files ending with .conf, including those in the conf.d directory
                 - ncidd.blacklist
                 - ncidd.whitelist
                 - ncidd.alias
                 
            Copy ncid-VERSION.mac-osx.tgz to the Mac, then:
                sudo tar -xzvf ncid-VERSION-mac-osx.tgz -C /
                EXAMPLE: sudo tar -xzvf ncid-0.85.mac-osx.tgz -C /

            You will need to manually compare your backed up configuration
            files with the new ones, and manually edit any differences.
                
        - If there is no binary package, you need to compile the source.
          Your existing configuration files will be preserved, and new ones
          installed will have .new as the extension.
            
            Copy ncid-VERSION-src.tar.gz to the Mac, then:
                tar -xzvf ncid-VERSION-src.tar.gz
                cd ncid
                make mac (compiles for /usr/local, see top of Makefile)
                sudo make mac-install

            You will need to manually compare your current configuration
            files with the ".new" ones, and manually edit any differences.
                                
CONFIGURE:

    The Makefile preconfigures ncidd.conf for the Mac, but you may
    want to change some of the defaults.

    - If you are using a gateway instead of a local modem,
      you need to set noserial to 1:
        set noserial = 1
    - If you are using a local modem with or without a gateway
        set noserial = 0  (this is the default)

FIRST STARTUP:

    - If you are running the server and client on the same computer
      and using a modem:
        sudo /usr/local/sbin/ncidd
        ncid &

    - If you are running the server and using a SIP gateway:
        sudo /usr/local/sbin/ncidd
        sudo /usr/local/sbin/sip2ncid
        ncid &

    - If you are running the server and using a YAC gateway:
        sudo /usr/local/sbin/ncidd
        sudo /usr/local/sbin/yac2ncid
        ncid &

    - Call yourself and see if it works. If not,
      stop the gateway first (if used), and then stop the server,
      using 'sudo kill' and the appropriate process ID.
      Continue by reading the test sections.

    - If everything is OK, enable the NCID server, gateways, and
      client modules you are using, to autostart at boot.

(AUTO)START/STOP:
        
    Under Mac OS X 10.4 and later, the mechanism used to start NCID processes
    is 'launchd' and requires 'plist' files in /Library/LaunchDaemons and/or
    /Library/LaunchAgents. Appropriate plist files for NCID server and client
    processes are created automatically when NCID is installed, however,
    they must be manually activated.
    
    Once activated, no action is typically required as the plist files are 
    configured to automatically start each time the system boots, or in the
    special case of the ncid GUI client, each time a user logs in.

    Here is the complete list of plist files:
    
        /Library/LaunchDaemons/net.sourceforge.ncid-initmodem.plist
        /Library/LaunchDaemons/net.sourceforge.ncid-notify.plist
        /Library/LaunchDaemons/net.sourceforge.ncid-page.plist
        /Library/LaunchDaemons/net.sourceforge.ncid-samba.plist
        /Library/LaunchDaemons/net.sourceforge.ncid-speak.plist
        /Library/LaunchDaemons/net.sourceforge.ncid-yac.plist
        /Library/LaunchDaemons/net.sourceforge.ncid2ncid.plist
        /Library/LaunchDaemons/net.sourceforge.ncidd.plist
        /Library/LaunchDaemons/net.sourceforge.sip2ncid.plist
        /Library/LaunchDaemons/net.sourceforge.yac2ncid.plist
        /Library/LaunchAgents/net.sourceforge.ncid-gui.plist    
    
    You do not interact with launchd directly, instead you use the 'launchctl'
    command line utility.

    You should only activate the NCID servers and clients you need. Activating
    will also start the process immediately; there is no need to reboot.
    Because running the NCID client in GUI mode interacts with the user after 
    login, it is the only one located in /Library/LaunchAgents.

    The syntax for stopping the daemons is the same as starting them, except
    you use the 'unload' command instead of the 'load' command. Doing an unload
    stops the daemon immediately and prevents it from starting automatically
    the next time the system is booted.
    
    Here are some examples:
    - start the NCID server: 
      sudo launchctl load -w /Library/LaunchDaemons/net.sourceforge.ncidd.plist

    - stop the sip2ncid server: 
      sudo launchctl unload -w /Library/LaunchDaemons/net.sourceforge.sip2ncid.plist

    - start ncid with ncid-page:
      sudo launchctl load -w /Library/LaunchDaemons/net.sourceforge.ncid-page.plist
      
    - stop ncid GUI:
      sudo launchctl unload -w /Library/LaunchAgents/net.sourceforge.ncid-gui.plist   
      
    Review the man page (man launchctl).

CHECKING DAEMON STATUS:

    Use the launchctl 'list' command to show the daemons currently loaded, 
    optionally using fgrep to filter out only ncid related processes.
    
    Daemons currently running will have a process id.
    
    Daemons which were stopped without an error will not be listed at all.
    
    If a daemon has stopped due to an error, it will have no process id but 
    will have a numeric exit status. Examine the contents of the
    /var/log/system.log file to determine the problem. Once you fix the 
    problem, use the launchctl 'unload' command followed by the 'load' command.

    Example:  sudo launchctl list|fgrep net.sourceforge.ncid
    
    PID     Status  Label
    422     -       net.sourceforge.ncid-notify
    419     -       net.sourceforge.ncidd

TRIMMING LOG FILES:

The Mac uses newsyslog to trim files. To trim the cidcall.log and the
ciddata.log files, add this entry to /etc/newsyslog.conf

    /var/log/cid*.log   root:wheel 644 5 * $M1D0 GN
